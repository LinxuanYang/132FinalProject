{% extends 'search.html.jinja2' %}

{% block search_result %}
    {% if message %}

        {% for mes in message %}
            <div class="alert alert-danger" role="alert">
                {{ mes }}
            </div>
        {% endfor %}
    {% endif %}
    <div class="alert alert-success" role="alert">
        you have total of {{ res_num }} results matched
    </div>
    <div id="result_box">
        {% for result in results %}
            <div class="card search_result" data-hover-monitor data-drag-monitor data-id="{{ result.id }}"
                 data-queryId="{{ query_id }}">
                <div  class="card-body">
                    <a href="/movie/{{ result['id'] }}" class="card-title">{{ result['title']|e }}</a>
                    <p>score:{{ result['score'] }}</p>
                    <p class="card-text">{{ result['text'] }}</p>

                    <a data-click data-id="{{ result.id }}" data-queryId="{{ query_id }}"
                       href="/movie/{{ result['id'] }}" class="card-link">detail</a>
                </div>
            </div>
        {% endfor %}
    </div>

    <br>
    <nav aria-label="Page navigation example">
        <ul class="pagination">
            {% if page_number>1 %}
                <li class="page-item"><a class="page-link" href="javascript:void(0)" id="prev">Previous</a></li>
            {% endif %}

            {% if page_number <(res_num )/page_size %}
                <li class="page-item"><a class="page-link" href="javascript:void(0)" id="next">Next</a></li>
            {% endif %}
        </ul>
    </nav>
{% endblock %}

{% block extra_js %}
    {{ super() }}
    <script type="application/javascript">
        page_number = $('#page_number')
        page_val = {{ page_number }}
            search = $('#search')
        {% if similar %}
            form = search.parents('form')
            text = form.find('#text').val('')
            $('#prev,#next').on('click', function () {
                form[0].action = '/similar/{{ movie_id }}'
            })
        {% endif %}
        $('#prev').on('click', function () {
            page_number.val(parseInt(page_val) - 1)
            search.click()
        })
        $('#next').on('click', function () {
            page_number.val(parseInt(page_val) + 1)
            search.click()
        })
        window.queryId =
        {{ query_id }}
    </script>
{% endblock %}

